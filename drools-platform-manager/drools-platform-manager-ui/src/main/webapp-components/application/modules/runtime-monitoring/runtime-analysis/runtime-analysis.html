<div data-ng-controller="runtimeAnalysisController">
    <div class="page-header">
        <h3 style="margin-left:20px">Runtime Analysis</h3>
    </div>
    <div class="row col-sm-12">
        <div class="col-md-3">
            <div class="panel panel-default dataSource-panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Filter execution by Runtime</h3>
                </div>
                <div class="panel-body">
                    <!-- Search form -->
                    <form role="form" name="SearchForm">
                        <h4>Guvnor</h4>
                        <div class="form-group" ng-class="namePackageSelectClass">
                            <label for="package-name-select">Rule Package Name</label>
                            <select id="package-name-select" ui-select2="selectPackage" ng-model="filters.packageName"
                                    class="form-control"
                                    style="padding:0;height:auto;width:auto;"
                                    data-placeholder="Select a package">
                                <option value=""></option>
                                <option ng-repeat="p in packagesList" value="{{p}}">{{p}}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="iptstatus">Status</label>
                            <small>(Optional)</small>
                            <select id="iptstatus" ui-select2="selectStatus" ng-model="filters.status"
                                    class="form-control"
                                    style="padding:0;height:auto;width:auto;"
                                    data-placeholder="Select a runtime status">
                                <option value=""></option>
                                <option ng-repeat="s in statusesList" value="{{s.runtimeStatus}}">{{s.description}}
                                </option>
                            </select>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" ng-checked="filters.onlyRunningInstances" ng-model="filters.onlyRunningInstances">
                                Only running instances
                            </label>
                        </div>
                        <!-- Angular Bootstrap UI collapsing functionality -->
                        <!-- The boolean values of collapseStatus.firstBox, secondBox, etc. haven't been declared in the JS file. Apparently we don't need to do it -->
                        <div class="form-group">
                            <a ng-click="collapseStatus.firstBox=!collapseStatus.firstBox">
                                <span ng-show="!collapseStatus.firstBox"><i class="fa fa-plus-circle"></i> More filters : Runtime</span>
                                <span ng-show="collapseStatus.firstBox"><i class="fa fa-minus-circle"></i> Hide filters</span>
                            </a>
                            <div collapse="!collapseStatus.firstBox">
                                <h4>Runtime</h4>
                                <label for="IPaddr">Hostname</label>
                                <small>(Optional)</small>
                                <input id="IPaddr" class="form-control" name="hostname" type="text"
                                       placeholder="Enter the hostname" data-ng-model="filters.hostname">
                                <br>

                            </div>

                        </div>
                        <div class="form-group">
                            <a ng-click="collapseStatus.seconddBox=!collapseStatus.seconddBox">
                                <span ng-show="!collapseStatus.seconddBox"><i class="fa fa-plus-circle"></i> More filters : Session Execution</span>
                                <span ng-show="collapseStatus.seconddBox"><i class="fa fa-minus-circle"></i> Hide filters</span>
                            </a>
                            <div collapse="!collapseStatus.seconddBox">
                                <h4>SessionExecution</h4>
                                <label>From</label>
                                <div class="input-group col-md-6">
                                    <input type="text" class="form-control" datepicker-popup="{{format}}" ng-model="filters.startDate" is-open="datePickers.firstCalendar" min-date="dates.minDate" max-date="dates.maxDate" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" close-text="Close">
                                    <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event, 'startDate')"><i class="fa fa-calendar"></i></button></span>

                                </div>
                                <label>To</label>
                                <div class="input-group col-md-6">
                                    <input type="text" class="form-control" class="form-control" datepicker-popup="{{format}}" ng-model="filters.endDate" is-open="datePickers.secondCalendar" min-date="dates.minDate" max-date="'2014-07-29'" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" close-text="Close" ng-click="open($event, 'endDate')" >
                                    <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event, 'endDate')"><i class="fa fa-calendar"></i></button></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <button id="btn-cancel" class="btn btn-warning pull-left" ng-show="showCancelButton" ng-click="reset()">
                                <i class="fa fa-reply"></i>
                            </button>

                            <button id="btn-search" class="btn btn-info pull-right" ng-click="search()">
                                <i class="fa fa-search"></i> Search
                            </button>
                        </div>

                    </form>
                </div>

            </div>
        </div>
        <!-- Result -->
        <div  class="col-md-7 col-md-offset-1" >
            <div class="row">
                <div class="panel panel-default" style="min-height: 372px;">
                    <div class="panel-heading panel-title">
                        <h3 class="panel-title">All Runtimes <span ng-show="allRuntimes.length != 0">({{allRuntimes.length}} runtime(s))</span></h3>
                    </div>
                    <div class="panel-body">
                        <!-- Search result -->
                        <div class="table-wrapper-div" ng-show="allRuntimes.length != 0">
                            <table class="table table-hover text-center">
                                <thead>
                                <tr>
                                    <th class="bold">Rulebase ID</th>
                                    <th class="bold">Runtime URL</th>
                                    <!--th class="bold">Status</th-->
                                    <th class="bold">Rule Package name</th>
                                    <th class="bold">Session Execution ID</th>
                                    <th class="bold">Started at</th>
                                    <th class="bold">Ended at</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="runtime in allRuntimes"
                                    style="cursor:default" class="runtime-status-{{runtime.status}}">
                                    <td>{{runtime.ruleBaseID}}</td>
                                    <td>{{runtime.runtimeURL}}</td>
                                    <!--td>{{runtime.status}}</td-->
                                    <!-- data-content="test content <a href='' title='test add link'>link on content</a>" -->
                                    <td style="cursor:pointer"><span tooltip-placement="bottom" tooltip-html-unsafe="<b>Guvnor URL</b><br/><a href='{{runtime.guvnorUrl}}' target='_blank'>{{runtime.guvnorUrl}}</a>" tooltip-trigger="click" >{{runtime.rulePackage}}</span></td>
                                    <td>{{runtime.sessionId}}</td>
                                    <td>{{runtime.startDate}}</td>
                                    <td>{{runtime.endDate}}</td>
                                    <td><button class="btn " ng-click="loadDetails(runtime.ruleBaseID, runtime.sessionId);"><i class="fa fa-eye"></i></button></td>
                                </tr>
                                </tbody>
                            </table>

                        </div>
                        <!-- pagination ng-show="allRuntimes.length != 0" total-items="count" ng-model="currentPage" ng-change="pageChanged()"></pagination -->
                        <div class="col-md-6 col-md-offset-3" ng-show="allRuntimes.length != 0">
                            <pagination  total-items="count" ng-model="currentPage" max-size="5" class="pagination-sm" boundary-links="true" rotate="false" num-pages="numPages" ng-change="pageChanged()"></pagination>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Details -->
    <div id="detailsPanel" ng-show="sessionExecutionDetails.area" class="row col-md-12" style="overflow-y:auto" >
        <div class="page-header">
            <h3 style="margin-left:20px">Session Execution Details</h3>
        </div>
        <div class="col-md-10 col-md-offset-1" ng-show="sessionExecutionDetails.panel">
            <div class="panel panel-default">
                <div class="panel-heading panel-title">
                    <button type="button" class="close" aria-hidden="true" ng-click="closeDetailsPanel()" >&times;</button>
                    <h3 class="panel-title">All Rules Execution on Runtime </h3>
                </div>
                <div class="panel-body" style="min-height:700px;">
                    <div>
                        <div class="collapsible-sidebar" ng-class="{'slide-out':sidebarContracted}">
                            <button id="btn-searchDetails" class="btn btn-danger pull-right" ng-click="collapseSidebar()">
                                Close
                            </button>
                            <br>
                            <h3>Filter the details</h3>
                            <form role="form" name="SearchDetailsForm">
                                <h4>Rule</h4>
                                <div class="form-group" ng-class="ruleType">
                                    <label for="rule-category-select">Rule category</label>
                                    <select id="rule-category-select" ui-select2="selectCategory" ng-model="detailsFilters.ruleCategorySelect"
                                            class="form-control"
                                            style="padding:0;height:auto;width:auto;"
                                            data-placeholder="Select a category">
                                        <option value=""></option>
                                        <option ng-repeat="c in ruleAssetCategoryList" value="{{c.categoryName}}">{{c.categoryName}}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group" ng-class="ruleName">
                                    <label for="rule-name-select">Rule name</label>
                                    <select id="rule-name-select" ui-select2="selectRuleName" ng-model="detailsFilters.ruleNameSelect"
                                            class="form-control"
                                            style="padding:0;height:auto;width:auto;"
                                            data-placeholder="Select the rule name">
                                        <option value=""></option>
                                        <option ng-repeat="r in ruleNameList" value="{{r}}">{{r}}
                                        </option>
                                    </select>
                                </div>
                                <h4>Facts</h4>
                                <div class="form-group" ng-class="factType">
                                    <label for="fact-type-select">Fact type</label>
                                    <select id="fact-type-select" ui-select2="selectFactType" ng-model="detailsFilters.factTypeSelect"
                                            class="form-control"
                                            style="padding:0;height:auto;width:auto;"
                                            data-placeholder="Select a fact type">
                                        <option value=""></option>
                                        <option ng-repeat="f in facttypesList" value="{{f}}">{{f}}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <button id="btn-search" class="btn btn-info pull-right" ng-click="searchDetails()">
                                        Apply filters
                                    </button>
                                </div>

                            </form>

                        </div>
                        <div>
                            <tabset>
                                <tab heading="Input">
                                    <br>
                                    <div hljs source="code.input"></div>
                                </tab>
                                <tab heading="Output">
                                    <br>
                                    <div hljs source="code.output"></div>
                                </tab>
                                <tab heading="Event list">
                                    <br>
                                    <button id="btn-searchDetails" class="btn btn-info pull-left" ng-click="collapseSidebar()">
                                        <i class="fa fa-search"></i> Filters
                                    </button>
                                    <br>
                                    <br>
                                    <!-- TODO List for each processExecutions (sessionExecutionDetails in allSessionExecutionDetails)-->
                                    <fieldset>
                                        <legend>Process Details</legend>
                                        <ul class="list-unstyled">
                                            <li>
                                                <b>Process name : </b>{{allSessionExecutionDetails.processDetails.processName}}
                                            </li>
                                            <li>
                                                <b>Process Execution status : </b>{{allSessionExecutionDetails.processDetails.processExecutionStatus}}
                                            </li>
                                            <li>
                                                <b>Process type : </b>{{allSessionExecutionDetails.processDetails.processType}}
                                            </li>
                                        </ul>
                                    </fieldset>
                                    <accordion close-others="false">
                                        <!-- All Ruleflow Group-->
                                        <accordion-group is-open="status.ruleFlowGroupPanelOpen" ng-repeat="flowGroupDetails in allSessionExecutionDetails.allRuleFlowGroupDetails">
                                            <accordion-heading >
                                                <i class="fa fa-chevron-right" ng-show="!status.ruleFlowGroupPanelOpen"></i><i class="fa fa-chevron-down" ng-show="status.ruleFlowGroupPanelOpen"></i> Ruleflow{{flowGroupDetails.ruleflowGroup}}
                                            </accordion-heading>
                                            <accordion-group ng-repeat="ruleExecutionDetails in flowGroupDetails.allRuleExecutionDetails | filter:detailsFilters.ruleName | filter:detailsFilters.ruleCategory" ng-click="status.ruleExecutionOpen = !status.ruleExecutionOpen;">
                                                <accordion-heading >
                                                    <i class="fa fa-chevron-right" ng-show="!status.ruleExecutionOpen"></i><i class="fa fa-chevron-down" ng-show="status.ruleExecutionOpen"></i> Rule Execution : {{ruleExecutionDetails.ruleName}}
                                                </accordion-heading>
                                                <ul class="list-unstyled">
                                                    <li><b>Rule Execution Name : </b>{{ruleExecutionDetails.ruleName}}</li>
                                                    <li><b>Rule Package Name : </b>{{ruleExecutionDetails.packageName}}</li>
                                                    <li>
                                                        <b><a  ng-click="whenFacts = !whenFacts;"><i ng-show="!whenFacts" class="fa fa fa-plus-square-o"></i><i ng-show="whenFacts" class="fa fa-minus-square-o"></i> whenFacts </a>:</b> <br>
                                                        <!-- Had to add style="..." to keep indentation instead of class="list-unstyled" from bootstrap which doesn't keep indentation in addition of removing bullets -->
                                                        <ul collapse="!whenFacts" style="list-style-type:none;">
                                                            <li ng-repeat="whenFactItem in ruleExecutionDetails.whenFacts | filter:detailsFilters.factType:strict">
                                                                <a ng-click="indentJSON(whenFactItem); whenFactsDetails = !whenFactsDetails;"><i ng-show="!whenFactsDetails" class="fa fa fa-plus-square-o"></i><i ng-show="whenFactsDetails" class="fa fa-minus-square-o"></i> {{whenFactItem.fullClassName}}</a>
                                                                <div ng-show="whenFactsDetails" hljs source="whenFactItem.jsonFact"></div>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li>
                                                        <b><a  ng-click="thenFacts = !thenFacts;"><i ng-show="!thenFacts" class="fa fa fa-plus-square-o"></i><i ng-show="thenFacts" class="fa fa-minus-square-o"></i> thenFacts </a>:</b> <br>
                                                        <!-- Had to add style="..." to keep indentation instead of class="list-unstyled" from bootstrap which doesn't keep indentation in addition of removing bullets -->
                                                        <ul collapse="!thenFacts" style="list-style-type:none;">
                                                            <li ng-repeat="thenFactItem in ruleExecutionDetails.thenFacts | filter:detailsFilters.factType:strict">
                                                                <a ng-click="indentJSON(thenFactItem); thenFactsDetails = !thenFactsDetails;"><i ng-show="!thenFactsDetails" class="fa fa fa-plus-square-o"></i><i ng-show="thenFactsDetails" class="fa fa-minus-square-o"></i>  {{thenFactItem.fullClassName}}</a> <span class="label label-info">{{thenFactItem.factType}}</span>
                                                                <div ng-show="thenFactsDetails" hljs source="thenFactItem.jsonFact"></div>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </accordion-group>
                                        </accordion-group>
                                    </accordion>
                                </tab>
                            </tabset>
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    Rulebase ID : {{selectedRuleBaseID}}, Session Id : {{selectedSessionId}}
                </div>
            </div>
        </div>
    </div>
</div>